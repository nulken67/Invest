# analytical_engine.py

from sympy import symbols, diff, integrate, solve, sympify # –î–æ–±–∞–≤–ª—è–µ–º sympify

class AnalyticalEngine:
    def __init__(self):
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
        self.x, self.y, self.z, self.t = symbols('x y z t')

    def calculate_derivative(self, expression_str, variable_str):
        """–í—ã—á–∏—Å–ª—è–µ—Ç —Å–∏–º–≤–æ–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é."""
        try:
            variable = symbols(variable_str)
            expression = sympify(expression_str) 
            result = diff(expression, variable)
            return str(result)
        except Exception as e:
            return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}"

    def calculate_definite_integral(self, expression_str, variable_str, lower, upper):
        """
        –í—ã—á–∏—Å–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞–ª: 
        ‚à´[lower, upper] expression d(variable)
        """
        try:
            # 1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–±—ä–µ–∫—Ç—ã SymPy
            variable = symbols(variable_str)
            expression = sympify(expression_str)
            lower_bound = sympify(lower)
            upper_bound = sympify(upper)

            # 2. –í—ã—á–∏—Å–ª—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞–ª. 
            # –ê—Ä–≥—É–º–µ–Ω—Ç—ã: –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞, –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞)
            result = integrate(expression, (variable, lower_bound, upper_bound))
            
            # 3. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞, –æ—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–∏—Å–ª–µ–Ω–Ω–æ, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ
            if result.is_number:
                 return f"{result} (‚âà {result.evalf():.4f})"
            else:
                 return str(result)

        except Exception as e:
            return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}"

# --- –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ ---

def run_calculator():
    """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º."""
    engine = AnalyticalEngine()
    print("ü§ñ –°–∏–º–≤–æ–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (SymPy)")
    print("--------------------------------------------------")

    while True:
        print("\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é:")
        print("1: –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è")
        print("2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ò–Ω—Ç–µ–≥—Ä–∞–ª")
        print("exit: –í—ã—Ö–æ–¥")
        
        choice = input("–í–∞—à –≤—ã–±–æ—Ä (1/2/exit): ").lower()

        if choice == 'exit':
            print("üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
            break

        if choice == '1':
            ## --- –í–≤–æ–¥ –¥–ª—è –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π ---
            print("\n--- –†–µ–∂–∏–º –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π ---")
            expression = input("–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, x**3 + sin(x)): ")
            variable = input("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, x): ")
            
            result = engine.calculate_derivative(expression, variable)
            print(f"\n‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: d/d({variable})[{expression}] = {result}")
            
        elif choice == '2':
            ## --- –í–≤–æ–¥ –¥–ª—è –ò–Ω—Ç–µ–≥—Ä–∞–ª–∞ ---
            print("\n--- –†–µ–∂–∏–º –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–≥—Ä–∞–ª–∞ ---")
            expression = input("–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, x**2): ")
            variable = input("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, x): ")
            lower = input("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∂–Ω–∏–π –ø—Ä–µ–¥–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0): ")
            upper = input("–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2): ")
            
            result = engine.calculate_definite_integral(expression, variable, lower, upper)
            print(f"\n‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ò–Ω—Ç–µ–≥—Ä–∞–ª {expression} –æ—Ç {lower} –¥–æ {upper} = {result}")

        else:
            print("‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ 1, 2 –∏–ª–∏ exit.")

if __name__ == "__main__":
    run_calculator()
